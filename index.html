<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Demonstrator for Autocompleter.Local.MultiContent</title>
    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8">
    <script type="text/javascript" src="lib/prototype.js"></script>
    <script type="text/javascript" src="lib/scriptaculous.js"></script>
    <script type="text/javascript" src="src/AutocompleterLocalMultiContent.js"></script>
    <script type="text/javascript" charset="utf-8">
      var userIds = [];
      
      function toggleUser() {
        var dataSet = mc.lastSelection;
        
        if(userIds.indexOf(dataSet.id) == -1) {
          userIds.push(dataSet.id);
          var container = renderUser(dataSet);
          var remove = new Element("a", {href:"#", onclick: "removeUser("+dataSet.id+")", style:"float:right"}).update("remove");
          container.insert(new Element("br"));
          container.insert(remove);
          $("user").insert({bottom: container});
        } else {
          removeUser(dataSet.id)
        }
        
        $("autocompletion_text_field").value = "";
        $("preview").fade();
      }
      
      function removeUser(id) {
        userIds.pop(id);
        $("userContainer"+id).remove();
      }
      
      function renderUser(dataSet, id) {
        var container = new Element("div", {id: "userContainer"+dataSet.id, "class": "userContainer"});
        container.insert(new Element("img", {src: dataSet.img}));
        container.insert(new Element("span").update(dataSet.displayValue));
        
        return container;
      }
    </script>
  </head>
  <body>
    <form onsubmit="toggleUser(); return false;">
      <span style="text-align: center; font-size: 14px; display: block; margin-bottom: 5px">Type some letters. (Try 'Max')</span>
      <input type="text" id="autocompletion_text_field" />
      <input type="submit" value="go" />
    </form>
    <div id="autocompletion_hints" class="autocomplete"></div>
    <div id="user"></div>
    <div id="preview"></div>
    
    <script type="text/javascript" charset="utf-8">
      var hints = [
        {displayValue: "John Doe",        id: 1, img: "img/user.png",     displayImage: "img/user_small.png"},
        {displayValue: "Jane Doe",        id: 2, img: "img/user.png"},
        {displayValue: "Max Mustermann",  id: 3, img: "img/user.png",     displayImage: "img/user_small.png"},
        {displayValue: "Maxi Mustermann", id: 4, img: "img/user.png"},
        {displayValue: "Max Mustermann",  id: 5, img: "img/contact.png",  displayImage: "img/contact_small.png"},
        {displayValue: "James Bond",      id: 6, img: "img/jb.png",       displayImage: "img/jb_small.png"}
      ];
      
      mc = new Autocompleter.Local.MultiContent(
        "autocompletion_text_field",
        "autocompletion_hints",
        hints,
        {
          partialChars: 0,
          fullSearch: true,
          onSelect: function(selection) {
            var container = renderUser(selection);
            container.insert(new Element("br"));
            container.insert(new Element("span", {style: "float: right; color: red"}).update("preview"));
            
            $("preview").innerHTML = "";
            $("preview").insert(container);
            $("preview").appear({
              afterFinish: function(){
                window.setTimeout(function(){
                  $("preview").fade();
                }, 5000);
              }
            });
          },
          identifier: "id"
        }
      );
      
      $("autocompletion_text_field").focus();
    </script>
  </body>
</html>